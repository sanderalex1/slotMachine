<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="style.css" />
  <script src="app.js" defer></script>
  <script defer>
    let bet = 1;
    let pl = 0;

    let elements = {};

    setTimeout(() => {
      elements = {
        win: document.getElementById("win"),
        bankroll: document.getElementById("bankroll"),
        bet: document.getElementById("bet"),
        spin: document.getElementById("spin"),

        cherries1Payout: document.getElementById("cherries1Payout"),
        cherries2Payout: document.getElementById("cherries2Payout"),
        cherries3Payout: document.getElementById("cherries3Payout"),
        bananasPayout: document.getElementById("bananasPayout"),
        grapesPayout: document.getElementById("grapesPayout"),
        watermelonsPayout: document.getElementById("watermelonsPayout"),
        bellsPayout: document.getElementById("bellsPayout"),
        lucky7sPayout: document.getElementById("lucky7sPayout"),
        starsPayout: document.getElementById("starsPayout"),
      };

      console.log(elements);
      console.log(window.currentBankroll);
      elements.bankroll.textContent = window.currentBankroll;
      updatePayoutTable();
      console.log("Payout test", payout(["C", "b", "b"], 1));
    }, 100);

    function symbolValue(symbol) {
      return 1 + Math.floor(Math.random() * 10);
    }
    const symbolNameByCode = { C: 'cherries', b: 'bananas', G: 'grapes', W: 'watermelon', B: 'bells', L: 'lucky7s', S: 'stars' };
    const symbolOrder = ['cherries', 'bananas', 'grapes', 'watermelon', 'bells', 'lucky7s', 'stars'];
    function buildTrackHTML(repetitions = 3, startIndex = 0) {
      const order = symbolOrder.slice();
      const len = order.length;
      const shift = ((startIndex % len) + len) % len;
      for (let i = 0; i < shift; i++) order.push(order.shift());
      let html = '';
      for (let r = 0; r < repetitions; r++) {
        for (const name of order) {
          html += `
          <div class="symbol-wrap">
            <img class="symbol symbol--normal" src="img/${name}.webp" alt="${name}">
            <img class="symbol symbol--blur" src="img/${name}-blur.webp" alt="${name} blurred" aria-hidden="true">
          </div>`;
        }
      }
      return html;
    }

    function updatePayoutTable() {
      console.log(elements);
      elements.cherries1Payout.textContent = payout(["C", "b", "b"], currentBet);
      elements.cherries2Payout.textContent = payout(["C", "C", "b"], currentBet);
      elements.cherries3Payout.textContent = payout(["C", "C", "C"], currentBet);
      elements.bananasPayout.textContent = payout(["b", "b", "b"], currentBet);
      elements.grapesPayout.textContent = payout(["G", "G", "G"], currentBet);
      elements.watermelonsPayout.textContent = payout(["W", "W", "W"], currentBet);
      elements.bellsPayout.textContent = payout(["B", "B", "B"], currentBet);
      elements.lucky7sPayout.textContent = payout(["L", "L", "L"], currentBet);
      elements.starsPayout.textContent = payout(["S", "S", "S"], currentBet);
      elements.bet.textContent = currentBet;
    }

    function handleIncreaseBet() {
      increaseBet();
      updatePayoutTable();
      elements.bet.textContent = currentBet;
    }

    async function handleSpin() {
      elements.win.textContent = "";
      elements.spin.disabled = true;
      const result = spin();
      console.log(result);

      const slots = Array.from(document.querySelectorAll('.slot'));
      // Rebuild full tracks so multiple symbols pass by on every spin
      for (let i = 0; i < slots.length; i++) {
        const track = slots[i].querySelector('.slot-track');
        if (!track) continue;
        track.innerHTML = buildTrackHTML(3, Math.floor(Math.random() * symbolOrder.length));
      }
      // start spinning (downwards)
      slots.forEach(slot => { slot.classList.remove('is-settling'); slot.classList.add('is-spinning'); });

      // staggered stop: right reels keep spinning a bit longer
      for (let i = 0; i < slots.length; i++) {
        const slot = slots[i];
        const delay = 100 + Math.random() * 800; // 100-500ms
        await new Promise(resolve => setTimeout(resolve, i === 0 ? 500 : delay));

        // stop this reel
        slot.classList.remove('is-spinning');

        // replace content to show only the landed symbol for this reel with a quick settle
        const track = slot.querySelector('.slot-track');
        if (!track) continue;
        const symbolCode = result[i];
        const name = symbolNameByCode[symbolCode];
        if (!name) continue;
        slot.classList.add('is-settling');
        track.innerHTML = `
          <div class="symbol-wrap">
            <img class="symbol symbol--normal" src="img/${name}.webp" alt="${name}">
            <img class="symbol symbol--blur" src="img/${name}-blur.webp" alt="${name}" aria-hidden="true">
          </div>
        `;
        setTimeout(() => slot.classList.remove('is-settling'), 350);
      }

      // all reels stopped
      elements.spin.disabled = false;

      if (isWinner(result)) {
        elements.win.textContent = payout(result, currentBet);
        elements.bankroll.textContent = window.currentBankroll;
        console.log(`player won ${payout(result, currentBet)}`);
      }
    }



    updatePayoutTable();
  </script>
</head>

<body>
  <main>
    <section class="slot-machine-payout-table">
      <h2>Payout Table</h2>
      <table>
        <colgroup>
          <col class="col-symbol">
          <col class="col-payout">
        </colgroup>
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Payout</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
              </div>
              <span class="symbol-label">Cherries x 1</span>
            </td>
            <td class="payout"><span id="cherries1Payout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
              </div>
              <span class="symbol-label">Cherries x 2</span>
            </td>
            <td class="payout"><span id="cherries2Payout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                  class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                  class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
                <img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries">
              </div>
              <span class="symbol-label">Cherries x 3</span>
            </td>
            <td class="payout"><span id="cherries3Payout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas">
              </div>
              <span class="symbol-label">Bananas</span>
            </td>
            <td class="payout"><span id="bananasPayout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes">
              </div>
              <span class="symbol-label">Grapes</span>
            </td>
            <td class="payout"><span id="grapesPayout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons">
              </div>
              <span class="symbol-label">Watermelons</span>
            </td>
            <td class="payout"><span id="watermelonsPayout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/bells.webp" alt="Bells">
              </div>
              <span class="symbol-label">Bells</span>
            </td>
            <td class="payout"><span id="bellsPayout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s">
              </div>
              <span class="symbol-label">Lucky-7s</span>
            </td>
            <td class="payout"><span id="lucky7sPayout">0</span></td>
          </tr>
          <tr>
            <td class="symbol-cell">
              <div class="symbol-wrap">
                <img class="symbol symbol--normal" src="img/stars.webp" alt="Stars">
              </div>
              <span class="symbol-label">Stars</span>
            </td>
            <td class="payout"><span id="starsPayout">0</span></td>
          </tr>
        </tbody>
      </table>
    </section>


    <section class="slot-machine-reels">
      <div class="reel">
        <div class="slot">
          <div class="slot-track">
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
            <!-- duplicate for seamless loop -->
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
          </div>
        </div>
      </div>
      <div class="reel">
        <div class="slot">
          <div class="slot-track">
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
            <!-- duplicate for seamless loop -->
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
          </div>
        </div>
      </div>
      <div class="reel">
        <div class="slot">
          <div class="slot-track">
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
            <!-- duplicate for seamless loop -->
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/stars.webp" alt="Stars"><img
                class="symbol symbol--blur" src="img/stars-blur.webp" alt="Stars blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bells.webp" alt="Bells"><img
                class="symbol symbol--blur" src="img/bells-blur.webp" alt="Bells blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/watermelon.webp" alt="Watermelons"><img
                class="symbol symbol--blur" src="img/watermelon-blur.webp" alt="Watermelons blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/grapes.webp" alt="Grapes"><img
                class="symbol symbol--blur" src="img/grapes-blur.webp" alt="Grapes blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/bananas.webp" alt="Bananas"><img
                class="symbol symbol--blur" src="img/bananas-blur.webp" alt="Bananas blurred" aria-hidden="true"></div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/cherries.webp" alt="Cherries"><img
                class="symbol symbol--blur" src="img/cherries-blur.webp" alt="Cherries blurred" aria-hidden="true">
            </div>
            <div class="symbol-wrap"><img class="symbol symbol--normal" src="img/lucky7s.webp" alt="Lucky-7s"><img
                class="symbol symbol--blur" src="img/lucky7s-blur.webp" alt="Lucky-7s blurred" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </section>


    <section class="slot-machine-bottom-row">
      <div class="balance">
        <p>Balance: <span id="bankroll"></span></p>
        <p>Bet: <span id="bet">1</span></p>
        <p>Win: <span id="win"></span></p>
      </div>

      <button class="btn" onclick="handleIncreaseBet()">Increase Bet</button>
      <button class="btn" onclick="handleSpin()" id="spin">Spin</button>
    </section>
  </main>
</body>

</html>